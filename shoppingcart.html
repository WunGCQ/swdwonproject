<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>购物车</title>
    <script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/warning.js"></script>
    <script src="js/usercenter.js"> </script>
    <link rel="stylesheet" type="text/css" href="css/header.css"/>
    <link rel="stylesheet" type="text/css" href="css/footer.css"/>
    <link rel="stylesheet" type="text/css" href="css/model-window.css"/>
    <link rel="stylesheet" href="css/shoppping.css"/>
    <!--<link rel="stylesheet" type="text/css" href="css/user-center.css"/>-->
    <link rel="stylesheet" href="css/warning.css"/>
    <style>

        .address{
            width: 465px;
            display: inline-block;
            font-size: 14px;
        }
    </style>
</head>
<body onload="calculate_price()">
    <div id="container">
        <h2 style="text-align: center;margin-bottom: 15px;">购物车</h2>
        <div id="shoppingcart-null">
            您的购物车为空，去商店看看吧！
            <a href="http://index.php">去首页逛逛</a>
        </div>
        <div id="shoppingcart" class="tab active-wrap" style="text-align: center;">
            <div class="shoppingcart-list">
                <table style="margin: 10px auto;">
                    <tr style="background-color: #fff;text-align: center;height: 40px;padding: 0px;">
                        <th width="300px">商品名称</th>
                        <th width="120px">价格</th>
                        <th width="120px">数量</th>
                        <th width="120px">总价</th>
                        <th width="120px">操作</th>
                    </tr>
                    <tbody>
                    <tr class="software">
                        <td>商品名称</td>
                        <td>20</td>
                        <td>
                            <div class="select-amount-wrap">
                                <div class="amount-minus">-</div>
                                <input class="amount-number" type="text" value="1"/>
                                <div class="amount-add">+</div>
                            </div>
                        </td>
                        <td></td>
                        <td><span class="delete-software">删除</span></td>
                    </tr>
                    <tr class="software">
                        <td>
                            <img src="img/saber.jpg" alt=""/><span> Saber骑着摩托车奔驰在冬木市,吾王赛高！</span>
                        </td>
                        <td>99.99</td>
                        <td>
                            <div class="select-amount-wrap">
                                <div class="amount-minus">-</div>
                                <input class="amount-number" type="text" value="1"/>
                                <div class="amount-add">+</div>
                            </div>
                        </td>
                        <td></td>
                        <td><span class="delete-software">删除</span></td>
                    </tr>


                    <tr>
                        <td id="price-whole" colspan="5">3000</td>
                    </tr>
                    </tbody>
                </table>

            </div>
            <div id="select-address" class="tab active-wrap" style="text-align: left;">
                <div class="address selected-address">
                    <div>
                        <div class="address-name">填入姓名1</div>
                        <div class="address-phone">12345678912</div>
                        <div class="address-address">北京丝海淀区学院路37号北京航空航天大学5号公寓721室</div>
                    </div>
                </div>
                <div class="address">
                    <div>
                        <div class="address-name">填入姓名3</div>
                        <div class="address-phone">12345678912</div>
                        <div class="address-address">填入地址考虑到地址比较长所以就留的长度大一些</div>
                    </div>
                </div>
                <div class="address">
                    <div>
                        <div class="address-name">填入姓名3</div>
                        <div class="address-phone">12345678912</div>
                        <div class="address-address">填入地址考虑到地址比较长所以就留的长度大一些</div>
                    </div>
                </div>
                <div id="add-address-btn" onclick="$('#add-address').show();">
                    添加地址
                </div>
            </div>
            <div>
                <button class="btn" type="button" value="submit" onclick="" style="margin-right:0px;width:150px;font-size: 20px;">结算</button>
            </div>

        </div>
    </div>
    <div class="model-window" id="add-address">
        <div class="window-main" id="address-window">
            <span style="position:relative;float: right;font-size: 30px;cursor: pointer;" onclick="$('#add-address').hide();document.getElementById('add-address-form').reset();">×</span>
            <form action=" " method="post" id="add-address-form">
                <div class="form-group">
                    <!--<label for="username">用户名</label>-->
                    <input id="name" type="text" placeholder="请输入姓名" name="name" class="form-control"/>

                </div>
                <div class="form-group">
                    <!--<label for="password">密码</label>    -->
                    <input id="telephone" type="text" placeholder="请输入手机号" name="phone" class="form-control"/>

                </div>
                <div class="form-group">
                    <!--<label for="password">密码</label>    -->
                    <textarea id="address" placeholder="请输入收货地址" name="address" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <?php  echo "<button id=\"btn_addaddr\"class=\"btn\" type=\"button\" value=\"submit\" onclick=\"addAddr(".$u_id.")\">确认提交</button>"; ?>
                </div>
            </form>
        </div>
    </div>
<!--<div id="warning">-->
    <!--<div id="warning-window">-->
        <!--<div id="warning-title">警告！</div>-->
            <!--<div id="warning-close" style="" onclick="$('#warning').hide()">×</div>-->
        <!--<div id="warning-wrap">-->
            <!--<div id="warning-content">-->
                <!--吾王赛高！-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->

<!--</div>-->

</body>
<script>
    function changeAmount(Obj,num){
        var InputObj=$(Obj.parentNode.parentNode.parentNode).find(".amount-number");
        var amount=InputObj.val();
        console.log(amount);
        amount=parseInt(amount);
        if(num==0){
            return amount;
        }
        else if(num==-1){
            if(amount>1){
                if(amount==2){
                    $("#amount-minus").css({"background-color":"#f1f1f1"});
                }
                amount--;
                InputObj.val(amount);
                calculate_price();
            }
            else{
                $("#amount-minus").css({"background-color":"#f1f1f1"});
                return false;
            }
        }
        else if(num==1){
            amount++;
            $("#amount-minus").css({"background-color":"#ddd"});
            InputObj.val(amount);
            calculate_price();
        }
    }
    function calculate_price(){
        var shoppinglist=$(".shoppingcart-list>table");
        var softwares=$(".shoppingcart-list tr");
        var prices=new Array();
        var price_whole=parseFloat(0);
        if(softwares.length>1){
            for(var i=1;i<softwares.length-1;i++){

                var price_single=parseFloat($($(softwares[i]).children()[1]).text()).toFixed(2);

                var amount=parseFloat($(softwares[i]).find(".amount-number").val()).toFixed(2);

                var temp=parseFloat((price_single*amount).toFixed(2));
                $($(softwares[i]).children()[3]).text(temp.toString());
                price_whole+=temp;
            }
            $(softwares[softwares.length-1]).find("td").text(price_whole);
        }
        else{
        }
    }
    function setAddress(AddressObj){
        var selectedAddress=$(AddressObj);
        $(".address").attr("class","address");
        selectedAddress.attr("class","address selected-address");
        id=AddressObj.id;
        //TODO
        //在这里获取id~~和后续操作
    }
    function addAddr(u_id)
    {
        var a_name = $('#name').val();
        var a_telephone = $('#telephone').val();
        var a_address = $('#address').val();
        $.ajax({
            type: "POST",
            url: "addaddr.php",
            data: {u_id:u_id,a_name:a_name,a_telephone:a_telephone,a_address:a_address},
            dataType: "text",
            success: function(resText){
                if(resText == "error"){
                    alert("添加失败");
                    return;
                }
                var innerHTML="<div class=\"address\"><div><div class=\"address-name\">"+a_name+"</div><div class=\"address-phone\">"+a_telephone+"</div><div class=\"address-address\">"+a_address+"</div></div>"
//                var innerHTML = "<div id=\""+"haha"+"\" class=\"address\"><div><div class=\"address-name\">"+a_name+"</div><div class=\"address-phone\">"+a_telephone+"</div><div class=\"address-address\">"+a_address+"</div></div><div><div class=\"delete-address\">删除</div><div class=\"change-address\">修改</div></div></div>";
                $(document.getElementById('add_address').parentNode ).before(innerHTML);
            }
        });
    }
    $(".amount-minus").attr("onclick","changeAmount(this,-1)");
    $(".amount-add").attr("onclick","changeAmount(this,1)");
    $(".delete-software").attr("onclick","delete_tab(this)");
    $(".address").attr("onclick","setAddress(this)");
</script>
</html>